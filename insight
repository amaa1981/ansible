---
# Red Hat Insights has recommended one or more actions for you, a system administrator, to review and if you
# deem appropriate, deploy on your systems running Red Hat software. Based on the analysis, we have automatically
# generated an Ansible Playbook for you. Please review and test the recommended actions and the Playbook as
# they may contain configuration changes, updates, reboots and/or other changes to your systems. Red Hat is not
# responsible for any adverse outcomes related to these recommendations or Playbooks.
#
# remediate-ansible-repo-2x6xt
# https://cloud.redhat.com/insights/remediations/5e46d210-4b47-4958-8493-d440ae65a4c2
# Generated by Red Hat Insights on Sun, 15 Nov 2020 10:58:35 GMT
# Created by aliabbas@redhat.com

# New Ansible Engine packages are inaccessible when dedicated Ansible repo is not enabled
# Identifier: (advisor:ansible_deprecated_repo|ANSIBLE_DEPRECATED_REPO,fix)
# Version: ee6c70ac35309b933d79147388f9c703d3c68b25
- name: Enable ansible repo and update ansible package
  hosts: "node.example.com"
  become: true

  tasks:
    - name: Enable ansible repo
      command: subscription-manager repos --enable=rhel-7-server-ansible-2-rpms
      register: command_result
      changed_when: command_result.rc == 0

    - name: Update ansible package
      yum:
        name: ansible
        state: latest


- name: run insights
  hosts: "node.example.com"
  become: True
  gather_facts: False
  tasks:
    - name: run insights
      command: insights-client
      changed_when: false
